import{r as R,a as n,j as e,_ as i,F as U}from"./main.6.5.1.js";import{r as v}from"./react-vendor-de3885fb.js";import{u as C,a as T}from"./@tanstack/react-query-7661d13c.js";import{T as $,h as a,S as f,l as t,B as w,o as E,c as h,m as p,p as g,n as x}from"./antd-3ccb9cfc.js";import"./@emotion/react-b0c8361f.js";import"./react-router-dom-3b9cdbb6.js";import"./@tanstack/react-query-devtools-8ae3efe8.js";function z(){const{data:r,isLoading:u,isFetching:o}=C({refetchOnWindowFocus:!1,staleTime:12e4,queryKey:["fetch_permissions_settings"],queryFn:async()=>R({action:"permissions/get",method:"GET"})});return{isLoading:u,isFetching:o,permissions:r==null?void 0:r.data.permissions,roles:r==null?void 0:r.data.roles,users:r==null?void 0:r.data.users,commands:r==null?void 0:r.data.commands,fileTypes:r==null?void 0:r.data.fileTypes,wpRoot:r==null?void 0:r.data.wpRoot}}function j(){const{mutateAsync:r,isLoading:u}=T(async o=>R({action:"permissions/update",data:o}));return{updatePermission:o=>r(o),isPermissionUpdating:u}}function G(){const{useForm:r}=t,{isLoading:u,permissions:o,commands:d,fileTypes:b,roles:F,users:P,wpRoot:I}=z(),{updatePermission:S,isPermissionUpdating:_}=j(),[m]=r();v.useEffect(()=>{m.setFieldsValue(o)},[o,m]);const M=s=>{S(s).then(l=>{if(l.code==="SUCCESS"){x.success({message:l.message});const y=m.getFieldsError().map(c=>(c.errors&&(c.errors=[]),c));m.setFields(y)}else{const y=[];Object.keys(l.data).forEach(c=>{y.push({name:c.split("."),errors:l.data[c]}),x.error({message:(l==null?void 0:l.message)??i("Failed to update permission")})}),m.setFields(y)}})};return n(U,{children:[e(a,{title:"File Manager Shortcode",style:{marginInline:"0.625rem"},children:e($.Text,{copyable:{text:"[file-manager]"},children:"[file-manager]"})}),e(t,{form:m,onFinish:M,disabled:u||_,initialValues:o,colon:!1,scrollToFirstError:!0,children:n(f,{direction:"vertical",size:"middle",style:{display:"flex"},className:"px-2",children:[e(f,{style:{display:"flex",justifyContent:"right",paddingBlock:"8px"},children:e(t.Item,{style:{marginBottom:0},children:e(w,{type:"primary",htmlType:"submit",loading:_,children:"Update"})})}),n(a,{children:[e(t.Item,{name:"do_not_use_for_admin",label:i("Disable this permission inside WordPress dashboard"),tooltip:i("If disabled, the root folder for the file manager will be determined by this permission setting."),children:e(E,{})}),e(t.Item,{name:"fileType",label:"Allowed MIME types",children:e(h,{mode:"multiple",children:b==null?void 0:b.map(s=>e(h.Option,{value:s,children:s},s))})}),e(t.Item,{name:"file_size",label:"Max upload Size",children:e(p,{type:"number",placeholder:"Maximum File Size",addonAfter:"MB"})})]}),n(a,{title:i("Public folder options"),children:[e(t.Item,{name:"root_folder",children:e(p,{placeholder:"Root Folder Path"})}),e(t.Item,{name:"root_folder_url",children:e(p,{placeholder:"Root Folder URL"})}),e(t.Item,{name:"folder_options",label:i("Folder Options"),children:n(g.Group,{size:"large",children:[e(g,{value:"common",children:"Enable a common folder for everyone"}),e(g,{value:"user",children:"Enable separate folders for each user"}),e(g,{value:"role",children:"Enable folders for each user role"})]})})]}),e(a,{title:i("Permissions by Roles"),children:e(f,{size:20,wrap:!0,children:F==null?void 0:F.map(s=>n(a,{title:s.toUpperCase(),children:[e(t.Item,{name:["by_role",s,"path"],label:i("Path"),rules:[{pattern:new RegExp(`^${I}?(?:/[^/]+)*/?$`),message:i("Folder Path Must be within WordPress root directory")}],children:e(p,{placeholder:"Root Folder Path"})}),e(t.Item,{name:["by_role",s,"commands"],label:i("Enabled Commands"),children:e(h,{mode:"multiple",children:d==null?void 0:d.map(l=>e(h.Option,{value:l,children:l},l))})})]},`permissions-for-${s}`))})}),e(a,{title:i("Permissions by User"),children:e(f,{size:20,wrap:!0,children:P==null?void 0:P.map(s=>n(a,{title:s.display_name,children:[e(t.Item,{name:["by_user",s.ID,"path"],label:i("Path"),rules:[{pattern:new RegExp(`^${I}?(?:/[^/]+)*/?$`),message:i("Folder Path Must be within WordPress root directory")}],children:e(p,{placeholder:"Root Folder Path"})}),e(t.Item,{name:["by_user",s.ID,"commands"],label:i("Enabled Commands"),children:e(h,{mode:"multiple",children:d==null?void 0:d.map(l=>e(h.Option,{value:l,children:l},l))})})]},`permissions-for-${s.ID}`))})}),n(a,{title:i("Guest User Settings"),children:[e(t.Item,{name:["guest","path"],label:i("Path"),rules:[{pattern:new RegExp(`^${I}?(?:/[^/]+)*/?$`),message:i("Folder Path Must be within WordPress root directory")}],children:e(p,{placeholder:"Root Folder Path"})}),e(t.Item,{name:["guest","can_download"],label:i("can download?"),children:e(E,{})})]}),e(t.Item,{children:e(f,{style:{display:"flex",justifyContent:"center"},children:e(t.Item,{children:e(w,{type:"primary",htmlType:"submit",loading:_,children:"Update"})})})})]})})]})}export{G as default};
