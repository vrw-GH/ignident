/**
 * This file holds the main javascript functions needed for the option pages. also holds the alert plugin to notify users
 *
 * @author		Christian "Kriesi" Budschedl
 * @copyright	Copyright ( c ) Christian Budschedl
 * @link		http://kriesi.at
 * @link		http://aviathemes.com
 * @since		Version 1.0
 * @package 	AviaFramework
 */
jQuery((function(a){a("#avia_options_page").avia_framework_option_pages(),a("#avia_options_page").avia_create_option_navigation(),a("#avia_options_page .avia_tab_container").avia_media_advanced_plugin(),a("body").avia_popups(),a("body").trigger("avia_options_page_loaded")})),function(a){a.fn.avia_create_option_navigation=function(e){return this.each((function(){if(a("#avia_options_page").length){var e=a(this),t=a(".avia_options_container",e),i=a(".avia_section_header",e),o=a(".avia_sidebar_content"),n=window.location.hash.replace(/^\#goto_/,"avia_"),s=a(".avia_subpage_container",e).filter('[id="'+n+'"]');i.each((function(){var e=a(this),t=e.parent(".avia_subpage_container"),i=t.attr("id").replace(/^\avia_/,"goto_");s.length?t.is("#"+n)&&(e.addClass("avia_active_nav"),a(".avia_subpage_container").removeClass("avia_active_container"),t.addClass("avia_active_container")):t.is(":visible")&&e.addClass("avia_active_nav"),e.clone(!1).appendTo(o).css({display:"block"}).addClass(i).on("click",(function(){t.is(":visible")||(a(".avia_subpage_container").removeClass("avia_active_container"),t.addClass("avia_active_container"),a(".avia_active_nav").removeClass("avia_active_nav"),a(this).addClass("avia_active_nav"))}))})),t.find('a[href*="goto_"]').on("click",(function(){return a(this.hash.replace("#",".")).trigger("click"),!1}))}}))}}(jQuery),function(a){a.fn.avia_framework_option_pages=function(t){return this.each((function(){var t=a(this);if(1==t.length){var i=a(".avia_submit",this),o=a(".avia_reset",this),n=a(".avia_reset_selected",this),s=a(".avia_import_button",this),r=a(".avia_import_delete_demo_button",this),d=a(".avia_import_parent_button",this),l=a("#avia_hidden_data",this),c=a(".avia_description.av-icons .av-show-hide-icon",this),v=a(".avia_checkbox .avia_description.av-icons .av-popup-wrap",this),_={container:a(this),ajaxUrl:a("input[name=admin_ajax_url]",l).val(),prefix:a("input[name=avia_options_prefix]",l).val(),optionSlug:a("input[name=avia_options_page_slug]",l).val(),action:a("input[name=action]",l).val(),actionReset:a("input[name=resetaction]",l).val(),nonce:a("input[name=avia-nonce]",l).val(),nonceReset:a("input[name=avia-nonce-reset]",l).val(),nonceImport:a("input[name=avia-nonce-import]",t).val(),nonceImportParent:a("input[name=avia-nonce-import-parent]",t).val(),ref:a("input[name=_wp_http_referer]",l).val(),first_call:a("input[name=avia_options_first_call]",l),saveButtons:i,object:e};i.on("click",{set:_},e.save),o.on("click",{set:_},e.reset),n.on("click",{set:_},e.resetSelected),s.on("click",{set:_},e.do_import),r.on("click",{set:_},e.delete_demo_files),d.on("click",{set:_},e.do_parent_import),c.on("click",e.ShowHideDescInfo),c.on("keydown",e.ShowHideDescInfoByKey),v.on("click",e.descriptionPopupClick),e.activateSaveButton(t),e.activateResetAllButton(t,o),e.sidebarToggle(t),_.first_call.length>0&&setTimeout((function(){e.save(_,!0)}),1e3)}}))};var e={sidebarToggle:function(e){var t=a(".avia_shop_option_link",e),i=a(".avia_options_page_inner",e);a(".avia_subpage_container",e);value=t.text(),t.on("click",(function(){return i.is(".avia_sidebar_active")?(i.removeClass("avia_sidebar_active"),t.html("[-]")):(i.addClass("avia_sidebar_active"),t.html(value)),!1}))},activateResetAllButton:function(e,t){var i=e.find('select[name="reset_options_button"]');0!=i.length&&(i.on("change",(function(){""==a(this).children("option:selected").val()?t.removeClass("avia_hidden avia_reset_inactive").addClass("avia_reset_active"):t.removeClass("avia_reset_active").addClass("avia_hidden avia_reset_inactive")})),i.trigger("change",{context:"manually"}))},activateSaveButton:function(e){var t=a(".avia_header .avia_button_inactive, .avia_footer .avia_button_inactive");a("input, select, textarea",e).not(".avia_button_inactive").not(".avia_dont_activate_save_buttons").on("keydown change",(function(a,e){"object"==typeof e&&"string"==typeof e.context&&"manually"==e.context||t.removeClass("avia_button_inactive")})),a(".avia_clone_set, .avia_remove_set, .avia_dynamical_add_elements").on("click",(function(){t.removeClass("avia_button_inactive")}))},save:function(e,t){void 0===t&&(t=!1);var i=1==t?e:e.data.set,o=a(this),n=a("input:text, input:hidden, input:radio:checked, input:checkbox, input:password, select, textarea",".avia_options_container"),s="",r=!1;return o.is(".avia_button_inactive")&&!t||(n.each((function(){var e=a(this),t=e.val(),i=e.attr("name");void 0!==i&&""!==i.trim()&&(e.is("input:checkbox")&&!e.is("input:checked")&&(t="disabled"),s+="&"+i+"="+encodeURIComponent(t))})),s=s.substr(1),a.ajax({type:"POST",url:i.ajaxUrl,data:{action:i.action,_wpnonce:i.nonce,_wp_http_referer:i.ref,prefix:i.prefix,slug:i.optionSlug,data:s},beforeSend:function(){t||(a(".avia_header .avia_loading, .avia_footer .avia_loading",i.container).css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),i.saveButtons.addClass("avia_button_inactive"))},error:function(){t||(a("body").avia_alert({the_class:"error",text:"Saving didnt work! <br/> Please reload the page and try again",show:4500}),i.saveButtons.removeClass("avia_button_inactive"))},success:function(e){if(!t)if(e.match("avia_save"))a("body").avia_alert(),r=!0;else{var o="";o=e.length>3?"Saving didnt work! <br/>The script returned the following error: <br/><br/>"+e:"Saving didnt work! <br/> Please reload the page and try again",a("body").avia_alert({the_class:"error",text:o,show:4500}),i.saveButtons.removeClass("avia_button_inactive")}},complete:function(e){if(!t){a(".avia_loading",i.container).fadeOut();var o={success:r};a("body").trigger("avia_options_data_saved",o)}}})),!1},do_parent_import:function(e){var t=a(this),i=e.data.set,o=a(".avia_import_parent_wait",i.container);return t.is(".avia_button_inactive")||0==confirm("Importing the Parent Theme Settings will overwrite your current Settings. Proceed anyways?")||a.ajax({type:"POST",url:i.ajaxUrl,data:{action:"avia_ajax_import_parent_settings",_wpnonce:i.nonceImportParent,_wp_http_referer:i.ref},beforeSend:function(){a(".avia_import_loading_parent",i.container).css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),t.addClass("avia_button_inactive"),o.slideDown()},error:function(){a("body").avia_alert({the_class:"error",text:"Importing didnt work! <br/> You might want to try reloading the page and then try again",show:4500}),t.removeClass("avia_button_inactive")},success:function(e){if(e.match("avia_import")){a(".avia_import_result_parent",i.container);a("body").avia_alert({text:"Alright!<br/>Import worked out, no problems whatsoever. <br/>The page will now be reloaded to reflect the changes"},(function(){window.location.hash="#wpwrap",window.location.reload(!0)}))}else t.removeClass("avia_button_inactive"),a("body").avia_alert({the_class:"error",text:"Importing didnt work! <br/> You might want to try reloading the page and then try again <br/> (The script returned the following message: <br/><br/>"+e+")",show:4500})},complete:function(e){a(".avia_import_loading_parent",i.container).fadeOut(),o.slideUp()}}),!1},delete_demo_files:function(e){e.preventDefault();var t=a(this),i=e.data.set,o=t.closest("#avia_demo"),n=t.parents(".avia_section").eq(0),s=a(".avia_import_wait.delete-wait",n),r=t.closest(".av-import-wrap-delete-demo"),d=n.find(".av-import-wrap"),l=r.hasClass("av-demo-immediate-delete");if(o.hasClass("av-demo-ajax-active")||t.hasClass("avia_button_inactive")||!r.hasClass("av-demo-downloaded"))return!1;var c={action:"avia_ajax_delete_demo_files",_wpnonce:i.nonceImport,_wp_http_referer:i.ref,delete_demo:t.data("import"),demo_name:t.data("demo_name"),demo_full_name:t.data("demo_full_name")};return a.ajax({type:"POST",url:i.ajaxUrl,data:c,beforeSend:function(){a(".avia_import_loading",n).css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),t.addClass("avia_button_inactive"),o.addClass("av-demo-ajax-active"),s.slideDown()},error:function(){a("body").avia_alert({the_class:"error",text:t.data("error_msg"),show:4500}),t.removeClass("avia_button_inactive")},success:function(e){e.match("avia_error")?(e=e.replace("avia_error-",""),a("body").avia_alert({the_class:"error",text:e,show:4500})):e.match("avia_demo_deleted")?(e=e.replace("avia_demo_deleted-",""),l?(window.location.hash="#wpwrap",window.location.reload(!0)):a("body").avia_alert({text:e,show:4500}),r.removeClass("av-demo-downloaded").addClass("av-demo-must-download"),d.removeClass("av-demo-downloaded").addClass("av-demo-must-download")):a("body").avia_alert({the_class:"error",text:t.data("script_error_msg")+" "+e,show:4500})},complete:function(e){a(".avia_import_loading",n).fadeOut(),s.slideUp(),t.removeClass("avia_button_inactive"),o.removeClass("av-demo-ajax-active")}}),!1},do_import:function(e){var t=a(this),i=e.data.set,o=t.closest("#avia_demo"),n=t.parents(".avia_section").eq(0),s=t.closest(".av-import-wrap"),r=a(".avia_import_wait.import-wait",n),d=a(".avia_import_wait.download-wait",n),l=null,c=n.find(".av-import-wrap-delete-demo"),v=!1,_=s.hasClass("av-demo-immediate-delete"),p=s.data("confirm_import"),u=s.data("download_error"),m=s.data("import_error"),h=s.data("script_error");if(o.hasClass("av-demo-ajax-active"))return!1;if(s.hasClass("av-disable-import"))return!1;if(s.hasClass("av-demo-must-download")){if(t.hasClass("avia_button_doing_download"))return!1;if(_&&!1===confirm(p))return!1;v=!0}else{if(t.is(".avia_button_inactive"))return!1;if(!(_&&s.hasClass("av-demo-was-downloaded")||!1!==confirm(p)))return!1}var f={action:"avia_ajax_import_data",_wpnonce:i.nonceImport,_wp_http_referer:i.ref,subaction:v?"download_demos":"import_demos",demo_full_name:t.data("demo_full_name")};return s.hasClass("av-downloadable-zip")?(f.download_url=t.data("download"),f.import_dir=t.data("import"),f.demo_name=t.data("demo_name"),l=s.hasClass("av-demo-must-download")?d:r):(f.files=t.data("files"),l=r),a.ajax({type:"POST",url:i.ajaxUrl,data:f,beforeSend:function(){a(".avia_import_loading",n).css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1}),t.addClass("avia_button_inactive"),o.addClass("av-demo-ajax-active"),v&&t.addClass("avia_button_doing_download"),l.slideDown()},error:function(){var e="";e=v?u:m,a("body").avia_alert({the_class:"error",text:e,show:4500}),t.removeClass("avia_button_inactive")},success:function(e){var i="";e.match("avia_error")?(t.removeClass("avia_button_inactive"),e=e.replace("avia_error-","").replace("avia_import-",""),a("body").avia_alert({the_class:"error",text:e,show:15500})):e.match("avia_import")?(e=e.replace("avia_import-","").replace("<p>Remember to update the passwords and roles of imported users.</p>",""),_&&setTimeout((function(){c.find(".avia_import_delete_demo_button").trigger("click")}),500),a("body").avia_alert({text:e,show:4500},(function(){_||(window.location.hash="#wpwrap",window.location.reload(!0))}))):e.match("avia_downloaded")?(e=e.replace("avia_downloaded-",""),_||a("body").avia_alert({text:e,show:4500}),s.removeClass("av-demo-must-download").addClass("av-demo-downloaded").addClass("av-demo-was-downloaded"),c.length>0&&c.removeClass("av-demo-must-download").addClass("av-demo-downloaded"),t.removeClass("avia_button_inactive"),_&&setTimeout((function(){t.trigger("click")}),500)):(t.removeClass("avia_button_inactive"),i=v?u+h+e:m+h+e,a("body").avia_alert({the_class:"error",text:i,show:4500},(function(){window.location.reload(!0)})))},complete:function(e){a(".avia_import_loading",n).fadeOut(),l.slideUp(),t.removeClass("avia_button_doing_download"),o.removeClass("av-demo-ajax-active")}}),!1},resetSelected:function(e){e.preventDefault();var t=a(this),i={},o=!1,n=t.data();if(a.each(["filter_tabs","filter_values","skip_tabs","skip_values"],(function(a,e){void 0!==n[e]&&(i[e]=n[e],o=!0)})),!o){var s=t.closest("#avia_upload");if(s.find("input#reset_filter_checkbox:checked").length>0){s.find("input#reset_keep_quick_css:checked").length>0&&(i.skip_values="avia:quick_css");var r=s.find("select#reset_filter_tabs").val();null!=r&&r.length>0&&(i.filter_tabs=r.join(","))}}e.data.set.filter=i,e.data.set.button_id=void 0!==t.attr("id")?t.attr("id"):"",e.data.set.object.reset.call(this,e)},reset:function(e){var t=e.data.set;if(t.container.find(".avia_reset").hasClass("avia_reset_inactive"))return alert("Reset of theme options has been blocked by option settings - no options have been changed."),!1;var i=void 0!==t.filter?t.filter:{},o=void 0!==t.button_id?t.button_id:"";return confirm("This will delete every theme setting made so far and revert the theme option pages to factory settings. \nDo you really want to do that? ")&&a.ajax({type:"POST",url:t.ajaxUrl,data:{action:t.actionReset,avia_filter:i,avia_id:o,avia_request:!0,_wpnonce:t.nonceReset,_wp_http_referer:t.ref},beforeSend:function(){a(".avia_header .avia_loading, .avia_footer .avia_loading, .avia_reset_selected_button .avia_loading",t.container).css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:1})},error:function(){a("body").avia_alert({the_class:"error",text:"Resetting didnt work! <br/> Please wait a few seconds and try again",show:4500})},success:function(e){if(e.match("avia_reset"))a("body").avia_alert({text:"Alright!<br/>Reset of options was successful. <br/>The page will now be reloaded to reflect the changes"},(function(){window.location.hash="wpwrap",window.location.reload(!0)}));else{var t="";t=e.length>3?"Resetting didnt work! <br/>The script returned the following error: <br/><br/>"+e:"Resetting didnt work! <br/> Please wait a few seconds and try again",a("body").avia_alert({the_class:"error",text:t,show:4500})}},complete:function(e){a(".avia_loading",t.container).fadeOut()}}),!1},descriptionPopupClick:function(a){a.preventDefault(),a.stopImmediatePropagation()},ShowHideDescInfo:function(e){e.preventDefault();let t=a(this),i=t.data("popup"),o=t.closest(".av-icons"),n=o.hasClass("av-animation"),s=o.find(".av-popup-wrap ."+i),r=t.find(".av-read-more"),d=r.data("more"),l=r.data("less"),c=t.hasClass("av-popup-open");if(c?r.html(d):r.html(l),n)if(c)s.css("max-height","0px"),s.removeClass("av-show-popup").css("visibility","hidden"),t.removeClass("av-popup-open");else{s.addClass("av-show-popup").css("visibility","visible");let a=s.prop("scrollHeight");s.css("max-height",a+50+"px"),t.addClass("av-popup-open")}else c?(s.removeClass("av-show-popup"),t.removeClass("av-popup-open")):(s.addClass("av-show-popup"),t.addClass("av-popup-open"))},ShowHideDescInfoByKey:function(t){let i=a(this);"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.ShowHideDescInfo.call(i,t))}}}(jQuery),function(a){a.fn.avia_alert=function(e,t){var i=a.extend({the_class:"success",text:"Alright !<br/>All options saved.",show:2200},e);return this.each((function(){var e=a(this),o=a("<div/>").addClass("avia_notification avia_notification_"+i.the_class).css("opacity",0).html('<div class="avia_notification_close_icon" href="#"></div><span class="avia_notification_icon"></span><div>'+i.text+"</div>").appendTo(e);o.find(".avia_notification_close_icon").on("click",(function(e){return e.preventDefault(),a(this).closest(".avia_notification").hide(),!1})),o.animate({opacity:.9},(function(){o.delay(i.show).fadeOut((function(){o.remove(),"function"==typeof t&&t()}))}))}))}}(jQuery),function(a){a.fn.avia_popups=function(e,t){var i=a.extend({template:'<div class="avia-popup {extra_class}"><div class="avia-popup-inner"><a href="#" class="popup-close script-close-avia-popup">×</a>{content}</div></div><div class="avia-popup-backdrop"></div>',selector:"*[data-avia-popup], .av-modal-image"},e),o=this,n=a("body"),s=!1;a();o.on("click",i.selector,(function(){var e=a(this),t=e.data("avia-popup"),o="",r="";return e.is(".av-modal-image")?(o="<img src='"+this.href+"' alt='' title='' class='av-modal-popup-image' />",r="av-modal-window-autoposition"):o=a("#"+t).html(),i.template=i.template.replace("{content}",o),i.template=i.template.replace("{extra_class}",r),a(i.template).appendTo(n),s=!0,!1})),o.on("click",".script-close-avia-popup, .avia-popup-backdrop",(function(){return s=!1,a(".avia-popup-backdrop, .avia-popup").remove(),!1})),o.on("keydown",(function(e){if(1==s&&27==e.keyCode)return s=!1,a(".avia-popup-backdrop, .avia-popup").remove(),!1}))}}(jQuery);